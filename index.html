// Функция для конвертации числа между системами счисления
function calc(number, fromBase, toBase) {
    try {
        // Проверка на пустой ввод
        if (!number || typeof number !== 'string' || number.trim() === '') {
            throw new Error('Пожалуйста, введите число');
        }

        // Удаляем возможные пробелы и приводим к верхнему регистру
        number = number.trim().toUpperCase();

        // Проверка корректности основания
        if (fromBase < 2 || fromBase > 36 || toBase < 2 || toBase > 36) {
            throw new Error('Основание системы счисления должно быть от 2 до 36');
        }

        // Проверка, что число соответствует указанной системе счисления
        const validChars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'.substring(0, fromBase);
        const regex = new RegExp(`^[${validChars}]+$`, 'i');
        if (!regex.test(number)) {
            throw new Error(`Число содержит недопустимые символы для системы с основанием ${fromBase}`);
        }

        // Преобразуем число в десятичную систему
        const decimalNumber = parseInt(number, fromBase);
        if (isNaN(decimalNumber)) {
            throw new Error('Не удалось преобразовать число. Проверьте правильность ввода.');
        }

        if (toBase === 10) {
            return decimalNumber.toString();
        }

        const digits = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        let result = "";
        
        // Особый случай для нуля
        if (decimalNumber === 0) {
            return "0";
        }
        
        let num = decimalNumber;
        // Преобразуем из десятичной в целевую систему
        while (num > 0) {
            const remainder = num % toBase;
            result = digits[remainder] + result;
            num = Math.floor(num / toBase);
        }
        
        return result;
    } catch (e) {
        throw e; // Перебрасываем ошибку для обработки в вызывающем коде
    }
}

// Обработчик кнопки с улучшенным выводом ошибок
document.getElementById('calculateBtn').addEventListener('click', function() {
    const number = document.getElementById('numberInput').value;
    const fromBase = parseInt(document.getElementById('fromBase').value);
    const toBase = parseInt(document.getElementById('toBase').value);
    
    const output = document.getElementById('output');
    output.innerHTML = '';
    
    try {
        const result = calc(number, fromBase, toBase);
        output.innerHTML = `
            <div style="margin-top: 20px; padding: 15px; background-color: #f0f0f0; border-radius: 5px;">
                <p><strong>Исходное число:</strong> ${number}<sub>${fromBase}</sub></p>
                <p><strong>Результат:</strong> ${result}<sub>${toBase}</sub></p>
            </div>
        `;
    } catch (e) {
        output.innerHTML = `
            <div style="margin-top: 20px; padding: 15px; background-color: #ffebee; border-radius: 5px; color: #c62828; border: 1px solid #ef9a9a;">
                <strong>Ошибка:</strong> ${e.message || 'Произошла неизвестная ошибка'}
            </div>
        `;
        console.error('Ошибка преобразования:', e);
    }
});

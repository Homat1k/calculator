// Функция для конвертации числа между системами счисления
function convertNumber(number, fromBase, toBase) {
    // Проверка входных данных
    if (typeof number !== 'string' || number.trim() === '') {
        throw new Error('Пожалуйста, введите число');
    }
    
    number = number.trim().toUpperCase();
    
    // Проверка оснований
    if (!Number.isInteger(fromBase) || !Number.isInteger(toBase) || 
        fromBase < 2 || fromBase > 36 || toBase < 2 || toBase > 36) {
        throw new Error('Основания должны быть целыми числами от 2 до 36');
    }
    
    // Проверка соответствия числа системе счисления
    const validChars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'.slice(0, fromBase);
    const invalidChar = [...number].find(c => !validChars.includes(c));
    if (invalidChar) {
        throw new Error(`Символ "${invalidChar}" недопустим в системе с основанием ${fromBase}`);
    }
    
    // Преобразование в десятичную систему
    const decimalValue = parseInt(number, fromBase);
    if (isNaN(decimalValue)) {
        throw new Error('Не удалось преобразовать число');
    }
    
    // Быстрый возврат для десятичной системы
    if (toBase === 10) {
        return decimalValue.toString();
    }
    
    // Преобразование из десятичной в целевую систему
    if (decimalValue === 0) return '0';
    
    const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    let result = '';
    let num = decimalValue;
    
    while (num > 0) {
        const remainder = num % toBase;
        result = digits[remainder] + result;
        num = Math.floor(num / toBase);
    }
    
    return result;
}

// Инициализация интерфейса
function initConverter() {
    document.body.innerHTML = `
        <div class="converter-container">
            <h1>Конвертер систем счисления</h1>
            <div class="input-group">
                <input type="text" id="numberInput" placeholder="Введите число" value="17">
                <div class="base-selectors">
                    <div>
                        <label for="fromBase">Из системы:</label>
                        <select id="fromBase"></select>
                    </div>
                    <div>
                        <label for="toBase">В систему:</label>
                        <select id="toBase"></select>
                    </div>
                </div>
            </div>
            <button id="convertBtn">Конвертировать</button>
            <div id="resultOutput"></div>
        </div>
    `;
    
    // Заполняем select-ы вариантами оснований
    const fillBaseOptions = (selectId, defaultValue) => {
        const select = document.getElementById(selectId);
        for (let i = 2; i <= 36; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            select.appendChild(option);
        }
        select.value = defaultValue;
    };
    
    fillBaseOptions('fromBase', 10);  // По умолчанию: из 10-й системы
    fillBaseOptions('toBase', 2);     // По умолчанию: в 2-ю систему
    
    // Обработчик конвертации
    document.getElementById('convertBtn').addEventListener('click', () => {
        const number = document.getElementById('numberInput').value;
        const fromBase = parseInt(document.getElementById('fromBase').value);
        const toBase = parseInt(document.getElementById('toBase').value);
        const output = document.getElementById('resultOutput');
        
        try {
            const result = convertNumber(number, fromBase, toBase);
            output.innerHTML = `
                <div class="result-success">
                    <p>${number}<sub>${fromBase}</sub> = ${result}<sub>${toBase}</sub></p>
                </div>
            `;
        } catch (error) {
            output.innerHTML = `
                <div class="result-error">
                    <p>Ошибка: ${error.message}</p>
                </div>
            `;
        }
    });
    
    // Автоматически запускаем конвертацию при загрузке
    document.getElementById('convertBtn').click();
}

// Инициализируем при загрузке страницы
document.addEventListener('DOMContentLoaded', initConverter);
